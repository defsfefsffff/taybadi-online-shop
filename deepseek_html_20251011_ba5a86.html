<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تایبادی بخر - فروشگاه آنلاین</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6cf7;
            --secondary-color: #8e6cf7;
            --accent-color: #ff6b6b;
            --dark-bg: #1a1a1a;
            --darker-bg: #121212;
            --dark-card: #2d2d2d;
            --dark-text: #e6e6e6;
            --light-text: #a0a0a0;
            --dark-border: #404040;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --tag-bg: rgba(255,255,255,0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--darker-bg);
            color: var(--dark-text);
            line-height: 1.6;
            padding-bottom: 60px;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 28px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }

        .logo i {
            font-size: 32px;
            color: white;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 8px 15px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        nav ul li a:hover, nav ul li a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* مخفی کردن لینک مدیریت در حالت پیش‌فرض */
        .admin-nav-item {
            display: none !important;
        }

        .admin-nav-item.visible {
            display: flex !important;
        }

        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1607082350899-7e105aa886ae?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            padding: 100px 0;
            text-align: center;
            border-radius: 12px;
            margin: 30px 0;
        }

        .hero h2 {
            font-size: 36px;
            margin-bottom: 20px;
            color: white;
        }

        .hero p {
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto 30px;
            color: var(--light-text);
        }

        .btn-hero {
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-hero:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-title {
            color: var(--primary-color);
            margin: 40px 0 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--dark-border);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 28px;
        }

        /* طراحی گرافیکی برای بخش ویژگی‌ها */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .feature-card {
            background: linear-gradient(145deg, #2d2d2d, #353535);
            border-radius: 16px;
            padding: 30px 25px;
            text-align: center;
            transition: all 0.4s ease;
            border: 1px solid var(--dark-border);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
            border-color: var(--primary-color);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .feature-icon::after {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: rgba(74, 108, 247, 0.1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }

        .feature-icon i {
            font-size: 32px;
            color: white;
            z-index: 1;
            position: relative;
        }

        .feature-card h3 {
            color: white;
            font-size: 20px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .feature-card p {
            color: var(--light-text);
            line-height: 1.7;
            font-size: 15px;
        }

        /* انیمیشن برای ظاهر شدن کارت‌ها */
        .feature-card {
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
            transform: translateY(30px);
        }

        .feature-card:nth-child(1) { animation-delay: 0.1s; }
        .feature-card:nth-child(2) { animation-delay: 0.2s; }
        .feature-card:nth-child(3) { animation-delay: 0.3s; }
        .feature-card:nth-child(4) { animation-delay: 0.4s; }
        .feature-card:nth-child(5) { animation-delay: 0.5s; }
        .feature-card:nth-child(6) { animation-delay: 0.6s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* استایل‌های محصولات */
        .products-toolbar {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }

        .products-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .product-item {
            background-color: var(--dark-card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
            border: 1px solid var(--dark-border);
            display: flex;
            gap: 20px;
        }

        .product-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .product-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--dark-border);
        }

        .product-details {
            flex: 1;
        }

        .product-title {
            font-size: 22px;
            margin-bottom: 12px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .product-description {
            color: var(--light-text);
            margin-bottom: 15px;
            font-size: 16px;
            line-height: 1.6;
        }

        .product-price {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .product-category-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 13px;
            color: white;
            background: var(--tag-bg);
            border: 1px solid rgba(255,255,255,0.04);
        }

        /* تم‌های دارک برای دسته‌بندی‌ها */
        .tag-digital-goods { 
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        .tag-mobile-tablet { 
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }
        .tag-laptop-computer { 
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            box-shadow: 0 2px 8px rgba(6, 182, 212, 0.3);
        }
        .tag-home-appliances { 
            background: linear-gradient(135deg, #f97316, #ea580c);
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
        }
        .tag-fashion-clothing { 
            background: linear-gradient(135deg, #ec4899, #db2777);
            box-shadow: 0 2px 8px rgba(236, 72, 153, 0.3);
        }
        .tag-beauty-health { 
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        .tag-food-drink { 
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }
        .tag-book-stationery { 
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }
        .tag-toy-child { 
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }
        .tag-car-tools { 
            background: linear-gradient(135deg, #6b7280, #4b5563);
            box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3);
        }
        .tag-sports-travel { 
            background: linear-gradient(135deg, #84cc16, #65a30d);
            box-shadow: 0 2px 8px rgba(132, 204, 22, 0.3);
        }
        .tag-art-handicrafts { 
            background: linear-gradient(135deg, #a855f7, #9333ea);
            box-shadow: 0 2px 8px rgba(168, 85, 247, 0.3);
        }
        .tag-pets { 
            background: linear-gradient(135deg, #f97316, #ea580c);
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
        }
        .tag-electronics-telecom { 
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        .tag-other { 
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            box-shadow: 0 2px 8px rgba(156, 163, 175, 0.3);
        }

        /* استایل‌های سبد خرید */
        .cart-container {
            background: linear-gradient(135deg, var(--dark-card), #353535);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--dark-border);
            margin: 20px 0;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--dark-border);
        }

        .cart-title {
            color: var(--primary-color);
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .cart-item:hover {
            background-color: rgba(0, 0, 0, 0.3);
        }

        .cart-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cart-item-image {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--dark-border);
        }

        .cart-item-details h3 {
            margin-bottom: 5px;
            color: white;
        }

        .cart-item-price {
            color: var(--primary-color);
            font-weight: bold;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background-color: var(--dark-border);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .quantity-btn:hover {
            background-color: var(--primary-color);
        }

        .cart-item-total {
            font-weight: bold;
            color: white;
        }

        .cart-summary {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid var(--dark-border);
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .total-label {
            font-size: 18px;
            color: var(--light-text);
        }

        .total-amount {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .checkout-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .checkout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .empty-cart {
            text-align: center;
            padding: 40px 0;
            color: var(--light-text);
        }

        .empty-cart i {
            font-size: 64px;
            margin-bottom: 20px;
            color: var(--dark-border);
        }

        /* استایل‌های اطلاعات مشتری */
        .customer-info-section {
            background: var(--dark-card);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid var(--dark-border);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--light-text);
            font-weight: bold;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: var(--dark-text);
            font-size: 16px;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
        }

        .ltr-input {
            direction: ltr;
            text-align: left;
        }

        /* استایل‌های پرداخت کارت به کارت */
        .payment-card {
            background: var(--dark-card);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid var(--dark-border);
        }

        .bank-info {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .bank-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 15px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .bank-number {
            font-family: monospace;
            font-size: 18px;
            letter-spacing: 2px;
            margin: 10px 0;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .card-number, .sheba-number {
            direction: ltr;
            unicode-bidi: bidi-override;
        }

        .persian-text {
            direction: rtl;
            text-align: center;
        }

        .copy-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .file-upload {
            border: 2px dashed var(--dark-border);
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: var(--primary-color);
            background: rgba(74, 108, 247, 0.05);
        }

        .file-upload i {
            font-size: 48px;
            color: var(--light-text);
            margin-bottom: 15px;
        }

        .preview-container {
            margin-top: 15px;
            text-align: center;
        }

        .preview-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid var(--dark-border);
        }

        .timer {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-family: monospace;
            font-size: 18px;
        }

        .bank-logo {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-weight: bold;
            color: #2c5aa0;
            font-size: 12px;
            text-align: center;
        }

        .steps {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }

        .steps::before {
            content: '';
            position: absolute;
            top: 20px;
            right: 0;
            left: 0;
            height: 2px;
            background: var(--dark-border);
            z-index: 1;
        }

        .step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: var(--dark-border);
            color: var(--light-text);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .step-text {
            font-size: 14px;
            color: var(--light-text);
        }

        .step.active .step-text {
            color: var(--primary-color);
        }

        /* استایل‌های مدیریت */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--dark-card), #353535);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--dark-border);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--light-text);
            font-size: 14px;
        }

        .payments-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .payment-item {
            background: linear-gradient(135deg, var(--dark-card), #353535);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--dark-border);
            transition: all 0.3s;
        }

        .payment-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--dark-border);
        }

        .payment-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .payment-id {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .payment-date {
            color: var(--light-text);
            font-size: 14px;
        }

        .payment-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .status-pending {
            background-color: var(--warning);
            color: black;
        }

        .status-completed {
            background-color: var(--success);
            color: white;
        }

        .status-cancelled {
            background-color: var(--danger);
            color: white;
        }

        .payment-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .customer-info, .payment-info-details {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
        }

        .info-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .customer-details, .payment-details-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .customer-name {
            font-weight: bold;
            color: white;
        }

        .customer-contact {
            color: var(--light-text);
            font-size: 14px;
        }

        .payment-amount {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 18px;
        }

        .payment-receipt {
            margin-top: 15px;
            text-align: center;
        }

        .receipt-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid var(--dark-border);
            cursor: pointer;
        }

        .payment-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--dark-border);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: black;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--light-text);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: var(--dark-border);
        }

        .about-content {
            background-color: var(--dark-card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--dark-border);
            margin: 20px 0;
        }

        footer {
            background-color: var(--dark-card);
            padding: 25px 0;
            text-align: center;
            margin-top: 50px;
            border-top: 1px solid var(--dark-border);
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .social-links {
            display: flex;
            gap: 15px;
        }

        .social-links a {
            color: var(--dark-text);
            font-size: 20px;
            transition: color 0.3s;
        }

        .social-links a:hover {
            color: var(--primary-color);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            transform: translateX(-150%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--danger);
        }

        /* استایل‌های احراز هویت */
        .auth-container {
            max-width: 400px;
            margin: 0 auto;
            background: var(--dark-card);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid var(--dark-border);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--dark-border);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--light-text);
            border-bottom: 3px solid transparent;
        }

        .auth-tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }

        /* استایل‌های جدید برای ویژگی‌های اضافه شده */
        .profile-container {
            background: var(--dark-card);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid var(--dark-border);
            margin-bottom: 20px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--dark-border);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            font-weight: bold;
        }

        .profile-details h2 {
            color: white;
            margin-bottom: 5px;
        }

        .profile-details p {
            color: var(--light-text);
        }

        .order-history {
            margin-top: 30px;
        }

        .order-item {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--dark-border);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-id {
            color: var(--primary-color);
            font-weight: bold;
        }

        .order-date {
            color: var(--light-text);
        }

        .order-status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-delivered {
            background: var(--success);
            color: white;
        }

        .status-shipping {
            background: var(--warning);
            color: black;
        }

        .status-processing {
            background: var(--primary-color);
            color: white;
        }

        .review-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--dark-border);
        }

        .review-form {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .review-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .review-author {
            font-weight: bold;
            color: white;
        }

        .review-date {
            color: var(--light-text);
            font-size: 12px;
        }

        .review-rating {
            color: #ffc107;
            margin-bottom: 5px;
        }

        .discount-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            color: white;
        }

        .discount-code {
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 18px;
            margin: 10px 0;
            display: inline-block;
        }

        .tracking-container {
            background: var(--dark-card);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid var(--dark-border);
            margin-bottom: 20px;
        }

        .tracking-steps {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }

        .tracking-step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .tracking-step.active .step-number {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .tracking-step.completed .step-number {
            background: var(--success);
            color: white;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notifications-panel {
            position: fixed;
            top: 80px;
            left: 20px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            padding: 15px;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }

        .notification-item {
            padding: 10px;
            border-bottom: 1px solid var(--dark-border);
            cursor: pointer;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item:hover {
            background: rgba(255,255,255,0.05);
        }

        /* ریسپانسیو */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            nav ul {
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .product-item {
                flex-direction: column;
            }

            .product-image {
                width: 100%;
                height: auto;
            }

            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .payment-details {
                grid-template-columns: 1fr;
            }
            
            .payment-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .payment-actions {
                flex-direction: column;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .tracking-steps {
                flex-direction: column;
                gap: 20px;
            }
            
            .notifications-panel {
                width: 250px;
                left: 10px;
            }
        }

        @media (max-width: 480px) {
            .container {
                width: 95%;
                padding: 10px;
            }
            
            .hero {
                padding: 60px 20px;
            }
            
            .hero h2 {
                font-size: 24px;
            }
            
            .feature-card {
                padding: 20px 15px;
            }
            
            .product-actions {
                flex-direction: column;
            }
            
            .cart-item-actions {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-store"></i>
                <h1>تایبادی بخر</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-section="home"><i class="fas fa-home"></i> صفحه اصلی</a></li>
                    <li><a href="#" class="nav-link" data-section="products"><i class="fas fa-box-open"></i> محصولات</a></li>
                    <li><a href="#" class="nav-link" data-section="cart"><i class="fas fa-shopping-cart"></i> سبد خرید</a></li>
                    <li><a href="#" class="nav-link" data-section="profile"><i class="fas fa-user"></i> پروفایل</a></li>
                    <li><a href="#" class="nav-link" data-section="about"><i class="fas fa-info-circle"></i> درباره ما</a></li>
                    
                    <!-- لینک مدیریت که فقط برای ادمین‌ها نمایش داده می‌شود -->
                    <li class="admin-nav-item">
                        <a href="#" class="nav-link" data-section="admin">
                            <i class="fas fa-cog"></i> مدیریت
                        </a>
                    </li>
                    
                    <li id="auth-nav-item">
                        <a href="#" class="nav-link" data-section="auth" id="auth-link">
                            <i class="fas fa-user"></i> <span id="auth-text">ورود / ثبت‌نام</span>
                        </a>
                    </li>
                    
                    <!-- آیکون اطلاع‌رسانی -->
                    <li class="notification-bell" id="notification-bell">
                        <a href="#" class="nav-link">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notification-badge">0</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- پنل اطلاع‌رسانی -->
    <div class="notifications-panel" id="notifications-panel">
        <div class="notification-item">
            <div class="notification-title">خوش آمدید!</div>
            <div class="notification-message">به تایبادی بخر خوش آمدید. از خرید خود لذت ببرید.</div>
            <div class="notification-time">هم اکنون</div>
        </div>
    </div>

    <div class="container">
        <!-- صفحه اصلی -->
        <section id="home" class="section active">
            <div class="hero">
                <h2>به تایبادی بخر خوش آمدید</h2>
                <p>فروشگاه اینترنتی با بهترین محصولات و قیمت‌ها</p>
                <button class="btn-hero" onclick="showSection('products')">
                    <i class="fas fa-shopping-bag"></i> مشاهده محصولات
                </button>
            </div>

            <!-- بخش تخفیف‌های ویژه -->
            <div class="discount-section">
                <h2><i class="fas fa-gift"></i> تخفیف‌های ویژه</h2>
                <p>از کدهای تخفیف زیر برای خریدهای خود استفاده کنید:</p>
                <div class="discount-code" id="discount-code-1">TAYBADI20 - 20% تخفیف</div>
                <div class="discount-code" id="discount-code-2">WELCOME10 - 10% تخفیف برای اولین خرید</div>
                <button class="btn btn-primary" onclick="copyDiscountCode('TAYBADI20')">
                    <i class="fas fa-copy"></i> کپی کد تخفیف
                </button>
            </div>

            <div class="about-content">
                <h2 class="section-title"><i class="fas fa-info-circle"></i> چرا تایبادی بخر؟</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shipping-fast"></i>
                        </div>
                        <h3>ارسال سریع و رایگان</h3>
                        <p>تحویل محصولات درب منزل در کمترین زمان ممکن با پیک رایگان برای خریدهای بالای 200 هزار تومان</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>ضمانت کیفیت و اصالت</h3>
                        <p>همه محصولات دارای گارانتی کیفیت و اصالت 18 ماهه با امکان بازگشت 7 روزه کالا</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <h3>پشتیبانی 24/7</h3>
                        <p>پشتیبانی آنلاین در تمام ساعات شبانه روز از طریق تلفن، چت و واتساپ</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <h3>تخفیف‌های ویژه</h3>
                        <p>بهترین قیمت بازار همراه با تخفیف‌های دوره‌ای و جشنواره‌های فصلی</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h3>پرداخت امن</h3>
                        <p>پرداخت آنلاین و کارت به کارت با امنیت کامل و پشتیبانی از کلیه کارت‌های بانکی</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-award"></i>
                        </div>
                        <h3>گارانتی بهترین قیمت</h3>
                        <p>در صورت یافتن قیمت کمتر در فروشگاه‌های معتبر، ما قیمت را مطابق می‌کنیم</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- محصولات -->
        <section id="products" class="section">
            <h2 class="section-title"><i class="fas fa-box-open"></i> محصولات فروشگاه</h2>

            <div class="products-toolbar">
                <div class="left">
                    <label for="category-filter" style="color:var(--light-text);">فیلتر بر اساس دسته‌بندی:</label>
                    <select id="category-filter">
                        <option value="all">همه دسته‌بندی‌ها</option>
                        <option value="کالای دیجیتال">کالای دیجیتال</option>
                        <option value="موبایل و تبلت">موبایل و تبلت</option>
                        <option value="لپ تاپ و کامپیوتر">لپ تاپ و کامپیوتر</option>
                        <option value="لوازم خانگی">لوازم خانگی</option>
                        <option value="مد و پوشاک">مد و پوشاک</option>
                        <option value="زیبایی و سلامت">زیبایی و سلامت</option>
                        <option value="خوراکی و نوشیدنی">خوراکی و نوشیدنی</option>
                        <option value="کتاب و لوازم تحریر">کتاب و لوازم تحریر</option>
                        <option value="اسباب بازی و کودک">اسباب بازی و کودک</option>
                        <option value="خودرو و ابزار">خودرو و ابزار</option>
                        <option value="ورزشی و سفر">ورزشی و سفر</option>
                        <option value="هنر و صنایع دستی">هنر و صنایع دستی</option>
                        <option value="حیوانات خانگی">حیوانات خانگی</option>
                        <option value="الکترونیک و مخابرات">الکترونیک و مخابرات</option>
                        <option value="سایر">سایر</option>
                    </select>
                </div>
                <div class="right">
                    <label for="sort-select" style="color:var(--light-text);">مرتب‌سازی:</label>
                    <select id="sort-select">
                        <option value="newest">جدیدترین</option>
                        <option value="price-asc">قیمت ↑</option>
                        <option value="price-desc">قیمت ↓</option>
                        <option value="rating">بالاترین امتیاز</option>
                    </select>
                </div>
            </div>

            <div class="products-container" id="products-container">
                <!-- محصولات اینجا نمایش داده می‌شوند -->
            </div>
        </section>

        <!-- سبد خرید -->
        <section id="cart" class="section">
            <h2 class="section-title"><i class="fas fa-shopping-cart"></i> سبد خرید شما</h2>
            <div class="cart-container">
                <div class="cart-header">
                    <h3 class="cart-title"><i class="fas fa-shopping-basket"></i> آیتم‌های سبد خرید</h3>
                </div>

                <div id="cart-items">
                    <div class="empty-cart" id="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>سبد خرید شما خالی است</h3>
                        <p>برای افزودن محصول به سبد خرید، به بخش محصولات مراجعه کنید</p>
                    </div>
                </div>

                <div class="cart-summary" id="cart-summary" style="display: none;">
                    <div class="cart-total">
                        <span class="total-label">مجموع سبد خرید:</span>
                        <span class="total-amount" id="cart-total">0 تومان</span>
                    </div>
                    
                    <!-- بخش کد تخفیف -->
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="discount-code-input">کد تخفیف (اختیاری)</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="discount-code-input" placeholder="کد تخفیف خود را وارد کنید" style="flex: 1;">
                            <button class="btn btn-primary" onclick="applyDiscount()">اعمال تخفیف</button>
                            <button class="btn btn-danger" onclick="removeDiscount()" id="remove-discount-btn" style="display: none;">حذف تخفیف</button>
                        </div>
                        <div id="discount-message" style="margin-top: 5px; font-size: 14px;"></div>
                    </div>
                    
                    <button class="checkout-btn" id="checkout-btn">
                        <i class="fas fa-credit-card"></i> ادامه و تکمیل اطلاعات
                    </button>
                </div>
            </div>
        </section>

        <!-- پروفایل کاربر -->
        <section id="profile" class="section">
            <h2 class="section-title"><i class="fas fa-user"></i> پروفایل کاربری</h2>
            
            <div class="profile-container" id="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar" id="profile-avatar">U</div>
                    <div class="profile-details">
                        <h2 id="profile-name">کاربر مهمان</h2>
                        <p id="profile-email">لطفاً وارد شوید</p>
                        <p id="profile-join-date"></p>
                    </div>
                </div>
                
                <div id="profile-content">
                    <div class="empty-state">
                        <i class="fas fa-user"></i>
                        <h3>لطفاً وارد حساب کاربری خود شوید</h3>
                        <p>برای مشاهده پروفایل و تاریخچه خریدها، ابتدا وارد شوید</p>
                        <button class="btn btn-primary" onclick="showSection('auth')">
                            <i class="fas fa-sign-in-alt"></i> ورود به حساب
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- اطلاعات مشتری -->
        <section id="customer-info" class="section">
            <h2 class="section-title"><i class="fas fa-user"></i> اطلاعات ارسال</h2>
            
            <div class="customer-info-section">
                <form id="customer-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first-name">نام</label>
                            <input type="text" id="first-name" required placeholder="نام خود را وارد کنید">
                        </div>
                        <div class="form-group">
                            <label for="last-name">نام خانوادگی</label>
                            <input type="text" id="last-name" required placeholder="نام خانوادگی خود را وارد کنید">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone">شماره تلفن</label>
                            <input type="tel" id="phone" required placeholder="09XXXXXXXXX" class="ltr-input">
                        </div>
                        <div class="form-group">
                            <label for="email">ایمیل (اختیاری)</label>
                            <input type="email" id="email" placeholder="email@example.com" class="ltr-input">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="address">آدرس کامل</label>
                        <textarea id="address" rows="3" required placeholder="آدرس کامل خود را وارد کنید"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">شهر</label>
                            <input type="text" id="city" required placeholder="شهر خود را وارد کنید">
                        </div>
                        <div class="form-group">
                            <label for="postal-code">کد پستی</label>
                            <input type="text" id="postal-code" required placeholder="کد پستی را وارد کنید" class="ltr-input">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="order-notes">یادداشت سفارش (اختیاری)</label>
                        <textarea id="order-notes" rows="2" placeholder="در صورت نیاز توضیحات خود را اینجا بنویسید..."></textarea>
                    </div>

                    <div class="cart-summary">
                        <div class="cart-total">
                            <span class="total-label">مجموع سفارش:</span>
                            <span class="total-amount" id="order-total">0 تومان</span>
                        </div>
                        <button type="button" class="checkout-btn" onclick="showPaymentSection()">
                            <i class="fas fa-credit-card"></i> ادامه به پرداخت
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- پرداخت -->
        <section id="payment" class="section">
            <h2 class="section-title"><i class="fas fa-credit-card"></i> پرداخت کارت به کارت</h2>
            
            <div class="steps">
                <div class="step active">
                    <div class="step-number">1</div>
                    <div class="step-text">اطلاعات حساب</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-text">آپلود رسید</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-text">تایید نهایی</div>
                </div>
            </div>

            <div class="timer">
                ⏰ زمان باقی‌مانده برای پرداخت: <span id="timer">60:00</span>
            </div>

            <div class="payment-card">
                <h2>🏦 اطلاعات حساب فروشگاه</h2>
                
                <div class="bank-info">
                    <div class="bank-card">
                        <div class="bank-logo">
                            سامان
                        </div>
                        <h3>💳 شماره کارت فروشگاه</h3>
                        <div class="bank-number card-number" id="card-number">6219 8619 5537 9796</div>
                        <button class="copy-btn" onclick="copyToClipboard('card-number')">
                            📋 کپی شماره کارت
                        </button>
                        
                        <h3 style="margin-top: 20px;">🏛️ شماره شبا</h3>
                        <div class="bank-number sheba-number" id="sheba-number">IR05 0560 6118 2701 6250 1230 02</div>
                        <button class="copy-btn" onclick="copyToClipboard('sheba-number')">
                            📋 کپی شماره شبا
                        </button>
                        
                        <h3 style="margin-top: 20px;">👤 نام دارنده حساب</h3>
                        <div class="bank-number persian-text">سعید صفاری سنگانی</div>
                        
                        <h3 style="margin-top: 20px;">💰 مبلغ قابل پرداخت</h3>
                        <div class="bank-number persian-text" id="payment-amount">0 تومان</div>
                        <button class="copy-btn" onclick="copyToClipboard('payment-amount')">
                            📋 کپی مبلغ
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>📝 شماره کارت شما (اختیاری)</label>
                    <input type="text" placeholder="XXXX-XXXX-XXXX-XXXX" id="user-card" maxlength="19" oninput="formatCardNumber(this)" class="ltr-input">
                </div>

                <div class="form-group">
                    <label>📸 آپلود تصویر رسید پرداخت</label>
                    <div class="file-upload" onclick="document.getElementById('receipt').click()">
                        <i class="fas fa-file-upload"></i>
                        <p>برای آپلود رسید کلیک کنید</p>
                        <p style="font-size: 12px; color: var(--light-text);">فرمت‌های مجاز: JPG, PNG (حداکثر 5MB)</p>
                    </div>
                    <input type="file" id="receipt" accept="image/*" style="display: none;" onchange="previewReceipt(event)">
                    
                    <div class="preview-container" id="preview-container"></div>
                </div>

                <div class="form-group">
                    <label>📞 شماره تماس (برای پیگیری)</label>
                    <input type="tel" placeholder="09XXXXXXXXX" id="payment-phone" maxlength="11" class="ltr-input">
                </div>

                <div class="form-group">
                    <label>💬 یادداشت (اختیاری)</label>
                    <textarea rows="3" placeholder="در صورت نیاز توضیحات خود را اینجا بنویسید..." id="payment-notes"></textarea>
                </div>

                <button class="btn btn-primary" onclick="submitPayment()">
                    <i class="fas fa-check-circle"></i> تایید و ارسال رسید
                </button>

                <div class="success-message" id="success-message" style="display: none; background: var(--success); color: white; padding: 20px; border-radius: 10px; text-align: center; margin-top: 20px;">
                    <h3>🎉 پرداخت شما ثبت شد!</h3>
                    <p>رسید پرداخت شما با موفقیت دریافت شد و در صف بررسی قرار گرفت.</p>
                    <p>شماره پیگیری: <strong id="tracking-number"></strong></p>
                    <p>✅ پس از تایید، سفارش شما ارسال خواهد شد.</p>
                    <button class="btn btn-primary" onclick="showSection('profile')">
                        <i class="fas fa-eye"></i> مشاهده وضعیت سفارش
                    </button>
                </div>
            </div>

            <!-- راهنمای پرداخت -->
            <div class="payment-card">
                <h3>📋 راهنمای پرداخت</h3>
                <div style="margin: 15px 0;">
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p>1. مبلغ <strong id="guide-amount">0 تومان</strong> به شماره کارت بالا واریز کنید</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p>2. از رسید پرداخت عکس واضح بگیرید</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p>3. عکس رسید را در باکس بالا آپلود کنید</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p>4. شماره تماس خود را وارد کنید</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p>5. روی دکمه "تایید و ارسال رسید" کلیک کنید</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- پیگیری سفارش -->
        <section id="tracking" class="section">
            <h2 class="section-title"><i class="fas fa-truck"></i> پیگیری سفارش</h2>
            
            <div class="tracking-container">
                <div class="form-group">
                    <label for="tracking-input">شماره پیگیری سفارش</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="tracking-input" placeholder="شماره پیگیری خود را وارد کنید" style="flex: 1;">
                        <button class="btn btn-primary" onclick="trackOrder()">پیگیری سفارش</button>
                    </div>
                </div>
                
                <div id="tracking-result">
                    <!-- نتیجه پیگیری اینجا نمایش داده می‌شود -->
                </div>
            </div>
        </section>

        <!-- درباره ما -->
        <section id="about" class="section">
            <h2 class="section-title"><i class="fas fa-info-circle"></i> درباره ما</h2>
            <div class="about-content">
                <p><strong>تایبادی بخر</strong> یک فروشگاه اینترنتی معتبر است که با هدف ارائه بهترین محصولات با قیمت‌های مناسب تأسیس شده است.</p>
                <p><strong>صاحب امتیاز:</strong> سعید صفاری سنگانی</p>
                <p>محصولات ارائه شده در تایبادی بخر همگی از برندهای معتبر و با کیفیت هستند.</p>
                <p>امنیت در خرید و پرداخت آنلاین از مهم‌ترین اصول ماست و با استفاده از جدیدترین تکنولوژی‌های امنیتی، اطلاعات شما را محافظت می‌کنیم.</p>
            </div>

            <div class="about-content">
                <h3 class="section-title"><i class="fas fa-address-card"></i> تماس با ما</h3>
                <p><strong>مدیریت:</strong> سعید صفاری سنگانی</p>
                <p>📱 واتساپ: 09030298233</p>
                <p>📧 ایمیل: seead8467@gmail.com</p>
                <p>🕒 ساعت پاسخگویی: ۹ صبح تا ۱۲ شب</p>
            </div>
        </section>

        <!-- مدیریت - فقط برای ادمین‌ها قابل دسترسی است -->
        <section id="admin" class="section">
            <h2 class="section-title"><i class="fas fa-user-shield"></i> پنل مدیریت</h2>
            
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-payments">0</div>
                    <div class="stat-label">کل پرداخت‌ها</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pending-payments">0</div>
                    <div class="stat-label">در انتظار تایید</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completed-payments">0</div>
                    <div class="stat-label">تکمیل شده</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-revenue">0</div>
                    <div class="stat-label">درآمد کل (تومان)</div>
                </div>
            </div>

            <div class="payment-card">
                <h3><i class="fas fa-credit-card"></i> مدیریت پرداخت‌ها</h3>
                
                <div class="payments-container" id="payments-container">
                    <!-- پرداخت‌ها اینجا نمایش داده می‌شوند -->
                </div>
            </div>

            <div class="payment-card">
                <h3><i class="fas fa-plus-circle"></i> افزودن محصول جدید</h3>
                <form id="product-form">
                    <div class="form-group">
                        <label for="product-name">نام محصول</label>
                        <input type="text" id="product-name" required placeholder="نام محصول را وارد کنید">
                    </div>
                    <div class="form-group">
                        <label for="product-price">قیمت (تومان)</label>
                        <input type="number" id="product-price" required placeholder="قیمت محصول را وارد کنید">
                    </div>
                    <div class="form-group">
                        <label for="product-description">توضیحات</label>
                        <textarea id="product-description" rows="3" placeholder="توضیحات محصول"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="product-category">دسته‌بندی</label>
                        <select id="product-category" required>
                            <option value="">انتخاب دسته‌بندی</option>
                            <option value="کالای دیجیتال">کالای دیجیتال</option>
                            <option value="موبایل و تبلت">موبایل و تبلت</option>
                            <option value="لپ تاپ و کامپیوتر">لپ تاپ و کامپیوتر</option>
                            <option value="لوازم خانگی">لوازم خانگی</option>
                            <option value="مد و پوشاک">مد و پوشاک</option>
                            <option value="زیبایی و سلامت">زیبایی و سلامت</option>
                            <option value="خوراکی و نوشیدنی">خوراکی و نوشیدنی</option>
                            <option value="کتاب و لوازم تحریر">کتاب و لوازم تحریر</option>
                            <option value="اسباب بازی و کودک">اسباب بازی و کودک</option>
                            <option value="خودرو و ابزار">خودرو و ابزار</option>
                            <option value="ورزشی و سفر">ورزشی و سفر</option>
                            <option value="هنر و صنایع دستی">هنر و صنایع دستی</option>
                            <option value="حیوانات خانگی">حیوانات خانگی</option>
                            <option value="الکترونیک و مخابرات">الکترونیک و مخابرات</option>
                            <option value="سایر">سایر</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="product-image">عکس محصول</label>
                        <div class="file-upload" onclick="document.getElementById('product-image').click()">
                            <i class="fas fa-upload"></i>
                            <p>برای آپلود عکس محصول کلیک کنید</p>
                            <p style="font-size: 12px; color: var(--light-text);">فرمت‌های مجاز: JPG, PNG (حداکثر 5MB)</p>
                        </div>
                        <input type="file" id="product-image" accept="image/*" style="display: none;" onchange="previewProductImage(event)">
                        <div class="preview-container" id="product-preview-container"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus-circle"></i> افزودن محصول
                    </button>
                </form>
            </div>
        </section>

        <!-- احراز هویت -->
        <section id="auth" class="section">
            <h2 class="section-title"><i class="fas fa-user"></i> ورود به حساب کاربری</h2>
            <div class="auth-container">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login">ورود</div>
                    <div class="auth-tab" data-tab="register">ثبت‌نام</div>
                </div>

                <form id="login-form" class="auth-form active">
                    <div class="form-group">
                        <label for="login-email">ایمیل</label>
                        <input type="email" id="login-email" required placeholder="ایمیل خود را وارد کنید">
                    </div>
                    <div class="form-group">
                        <label for="login-password">رمز عبور</label>
                        <input type="password" id="login-password" required placeholder="رمز عبور خود را وارد کنید">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> ورود به حساب
                    </button>
                </form>

                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="register-name">نام کامل</label>
                        <input type="text" id="register-name" required placeholder="نام کامل خود را وارد کنید">
                    </div>
                    <div class="form-group">
                        <label for="register-email">ایمیل</label>
                        <input type="email" id="register-email" required placeholder="ایمیل خود را وارد کنید">
                    </div>
                    <div class="form-group">
                        <label for="register-password">رمز عبور</label>
                        <input type="password" id="register-password" required placeholder="رمز عبور خود را وارد کنید">
                    </div>
                    <div class="form-group">
                        <label for="register-confirm-password">تکرار رمز عبور</label>
                        <input type="password" id="register-confirm-password" required placeholder="رمز عبور خود را تکرار کنید">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> ایجاد حساب کاربری
                    </button>
                </form>

                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;">💡 اطلاعات تست:</h4>
                    <p style="font-size: 14px; color: var(--light-text); margin: 5px 0;">
                        <strong>حساب ادمین:</strong><br>
                        ایمیل: admin@taybadi.com<br>
                        رمز عبور: admin123
                    </p>
                    <p style="font-size: 14px; color: var(--light-text); margin: 5px 0;">
                        <strong>حساب کاربری معمولی:</strong><br>
                        می‌توانید ثبت‌نام کنید یا از:<br>
                        ایمیل: user@example.com<br>
                        رمز عبور: user123
                    </p>
                </div>
            </div>
        </section>
    </div>

    <footer>
        <div class="container footer-content">
            <p>© ۱۴۰۴ تایبادی بخر - صاحب امتیاز: سعید صفاری سنگانی - تمام حقوق محفوظ است</p>
            <div class="social-links">
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-telegram"></i></a>
                <a href="#"><i class="fab fa-whatsapp"></i></a>
            </div>
        </div>
    </footer>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">عملیات با موفقیت انجام شد</span>
    </div>

    <script>
        // داده‌های اصلی
        let products = JSON.parse(localStorage.getItem('taybadi_products')) || [];
        let cart = JSON.parse(localStorage.getItem('taybadi_cart')) || [];
        let users = JSON.parse(localStorage.getItem('taybadi_users')) || [];
        let currentUser = JSON.parse(localStorage.getItem('taybadi_current_user')) || null;
        let payments = JSON.parse(localStorage.getItem('taybadi_payments')) || [];
        let customerInfo = JSON.parse(localStorage.getItem('taybadi_customer_info')) || {};
        let reviews = JSON.parse(localStorage.getItem('taybadi_reviews')) || [];
        let notifications = JSON.parse(localStorage.getItem('taybadi_notifications')) || [];
        let discountCodes = JSON.parse(localStorage.getItem('taybadi_discount_codes')) || [
            { code: 'TAYBADI20', discount: 20, type: 'percentage', active: true },
            { code: 'WELCOME10', discount: 10, type: 'percentage', active: true }
        ];
        
        // متغیر جدید برای مدیریت تخفیف
        let appliedDiscount = null;

        // المنت‌های مهم
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.section');
        const adminNavItem = document.querySelector('.admin-nav-item');
        const checkoutBtn = document.getElementById('checkout-btn');
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const authLink = document.getElementById('auth-link');
        const authText = document.getElementById('auth-text');
        const authNavItem = document.getElementById('auth-nav-item');
        const categoryFilter = document.getElementById('category-filter');
        const sortSelect = document.getElementById('sort-select');
        const notificationBell = document.getElementById('notification-bell');
        const notificationBadge = document.getElementById('notification-badge');
        const notificationsPanel = document.getElementById('notifications-panel');

        // تایمر پرداخت
        let paymentTimer;
        let timeLeft = 60 * 60;

        // تابع ایمن برای ذخیره در localStorage
        function safeSetItem(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
                return true;
            } catch (e) {
                console.error('خطا در ذخیره اطلاعات:', e);
                showNotification('خطا در ذخیره اطلاعات', true);
                return false;
            }
        }

        // تابع ایمن برای خواندن از localStorage
        function safeGetItem(key, defaultValue = []) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.error('خطا در خواندن اطلاعات:', e);
                return defaultValue;
            }
        }

        // اعتبارسنجی شماره تلفن
        function validatePhone(phone) {
            const phoneRegex = /^09[0-9]{9}$/;
            return phoneRegex.test(phone);
        }

        // به‌روزرسانی رابط کاربری بر اساس وضعیت ورود
        function updateAuthUI() {
            if (currentUser) {
                authText.textContent = currentUser.name;
                
                // نمایش اطلاعات کاربر در نوار ناوبری
                if (!document.querySelector('.user-info')) {
                    const userInfo = document.createElement('div');
                    userInfo.className = 'user-info';
                    userInfo.innerHTML = `
                        <div class="user-avatar">${currentUser.name.charAt(0)}</div>
                        <span>${currentUser.name}</span>
                    `;
                    authNavItem.appendChild(userInfo);
                }

                // نمایش دکمه خروج
                if (!document.getElementById('logout-btn')) {
                    const logoutBtn = document.createElement('button');
                    logoutBtn.id = 'logout-btn';
                    logoutBtn.className = 'btn btn-danger';
                    logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> خروج';
                    logoutBtn.style.marginRight = '10px';
                    logoutBtn.style.padding = '8px 15px';
                    logoutBtn.style.fontSize = '14px';
                    logoutBtn.addEventListener('click', logout);
                    authNavItem.appendChild(logoutBtn);
                }

                // مخفی کردن لینک احراز هویت
                authLink.style.display = 'none';

                // نمایش لینک مدیریت فقط برای ادمین‌ها
                if (currentUser.role === 'admin') {
                    adminNavItem.classList.add('visible');
                } else {
                    adminNavItem.classList.remove('visible');
                }
                
                // به‌روزرسانی پروفایل
                updateProfile();
                
                // به‌روزرسانی اطلاع‌رسانی‌ها
                updateNotifications();
            } else {
                authText.textContent = 'ورود / ثبت‌نام';
                authLink.style.display = 'flex';
                adminNavItem.classList.remove('visible');
                
                // حذف اطلاعات کاربر و دکمه خروج
                const userInfo = document.querySelector('.user-info');
                const logoutBtn = document.getElementById('logout-btn');
                if (userInfo) userInfo.remove();
                if (logoutBtn) logoutBtn.remove();
                
                // مخفی کردن پنل اطلاع‌رسانی
                notificationsPanel.style.display = 'none';
            }
        }

        // نمایش بخش‌ها
        function showSection(sectionId) {
            // بررسی دسترسی به بخش مدیریت
            if (sectionId === 'admin') {
                if (!currentUser || currentUser.role !== 'admin') {
                    showNotification('فقط مدیران می‌توانند به این بخش دسترسی داشته باشند!', true);
                    showSection('auth');
                    return;
                }
            }

            // مخفی کردن همه بخش‌ها
            sections.forEach(section => section.classList.remove('active'));
            navLinks.forEach(link => link.classList.remove('active'));

            // نمایش بخش انتخاب شده
            document.getElementById(sectionId).classList.add('active');
            const activeLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }

            // بارگذاری محتوای مربوطه
            if (sectionId === 'products') {
                renderProducts();
            } else if (sectionId === 'cart') {
                renderCart();
            } else if (sectionId === 'customer-info') {
                updateOrderTotal();
                loadCustomerInfo();
            } else if (sectionId === 'payment') {
                startPaymentTimer();
                updatePaymentAmount();
            } else if (sectionId === 'admin') {
                renderPayments();
                updateAdminStats();
            } else if (sectionId === 'profile') {
                updateProfile();
            } else if (sectionId === 'tracking') {
                // بخش پیگیری سفارش
            }
        }

        // سیستم احراز هویت
        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                currentUser = user;
                safeSetItem('taybadi_current_user', currentUser);
                updateAuthUI();
                showNotification(`خوش آمدید ${user.name}!`);
                
                // اضافه کردن اطلاع‌رسانی خوش‌آمدگویی
                addNotification('خوش آمدید!', `به تایبادی بخر خوش آمدید ${user.name}. از خرید خود لذت ببرید.`);
                
                showSection('home');
            } else {
                showNotification('ایمیل یا رمز عبور اشتباه است!', true);
            }
        }

        function register() {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            if (password !== confirmPassword) {
                showNotification('رمز عبور و تکرار آن مطابقت ندارند', true);
                return;
            }

            if (password.length < 6) {
                showNotification('رمز عبور باید حداقل ۶ کاراکتر باشد', true);
                return;
            }

            if (users.some(u => u.email === email)) {
                showNotification('این ایمیل قبلاً ثبت شده است', true);
                return;
            }

            const newUser = {
                id: Date.now(),
                name,
                email,
                password,
                role: 'user',
                createdAt: new Date().toISOString(),
                points: 100 // امتیاز هدیه برای ثبت‌نام
            };

            users.push(newUser);
            safeSetItem('taybadi_users', users);

            currentUser = newUser;
            safeSetItem('taybadi_current_user', currentUser);
            updateAuthUI();

            // اضافه کردن اطلاع‌رسانی ثبت‌نام موفق
            addNotification('ثبت‌نام موفق', 'حساب کاربری شما با موفقیت ایجاد شد! 100 امتیاز هدیه دریافت کردید.');

            showNotification('حساب کاربری با موفقیت ایجاد شد! 100 امتیاز هدیه دریافت کردید.');
            showSection('home');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('taybadi_current_user');
            updateAuthUI();
            showNotification('با موفقیت خارج شدید!');
            showSection('home');
        }

        // سیستم اعلان
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notificationText.textContent = message;
            notification.className = 'notification' + (isError ? ' error' : '');
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // سیستم محصولات
        function renderProducts() {
            const container = document.getElementById('products-container');
            const selectedCategory = categoryFilter.value;
            const sortType = sortSelect.value;
            
            let filteredProducts = products;
            
            // فیلتر بر اساس دسته‌بندی
            if (selectedCategory !== 'all') {
                filteredProducts = products.filter(product => product.category === selectedCategory);
            }
            
            // مرتب‌سازی
            if (sortType === 'price-asc') {
                filteredProducts.sort((a, b) => a.price - b.price);
            } else if (sortType === 'price-desc') {
                filteredProducts.sort((a, b) => b.price - a.price);
            } else if (sortType === 'newest') {
                filteredProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            } else if (sortType === 'rating') {
                filteredProducts.sort((a, b) => {
                    const aRating = calculateProductRating(a.id);
                    const bRating = calculateProductRating(b.id);
                    return bRating - aRating;
                });
            }
            
            if (filteredProducts.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-box-open"></i>
                        <h3>محصولی در این دسته‌بندی یافت نشد</h3>
                        <p>لطفاً دسته‌بندی دیگری را انتخاب کنید</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredProducts.map(product => {
                // تبدیل نام دسته‌بندی فارسی به کلاس انگلیسی
                const categoryMap = {
                    'کالای دیجیتال': 'digital-goods',
                    'موبایل و تبلت': 'mobile-tablet',
                    'لپ تاپ و کامپیوتر': 'laptop-computer',
                    'لوازم خانگی': 'home-appliances',
                    'مد و پوشاک': 'fashion-clothing',
                    'زیبایی و سلامت': 'beauty-health',
                    'خوراکی و نوشیدنی': 'food-drink',
                    'کتاب و لوازم تحریر': 'book-stationery',
                    'اسباب بازی و کودک': 'toy-child',
                    'خودرو و ابزار': 'car-tools',
                    'ورزشی و سفر': 'sports-travel',
                    'هنر و صنایع دستی': 'art-handicrafts',
                    'حیوانات خانگی': 'pets',
                    'الکترونیک و مخابرات': 'electronics-telecom',
                    'سایر': 'other'
                };
                
                const tagClass = 'tag-' + (categoryMap[product.category] || 'other');
                const rating = calculateProductRating(product.id);
                const reviewCount = getProductReviewCount(product.id);
                
                return `
                    <div class="product-item">
                        <img src="${product.image}" alt="${product.name}" class="product-image">
                        <div class="product-details">
                            <div class="product-title">
                                <h3>${product.name}</h3>
                                <span class="product-category-tag ${tagClass}">
                                    <i class="fas fa-tag"></i> ${product.category}
                                </span>
                            </div>
                            <p class="product-description">${product.description}</p>
                            <div class="product-price">${product.price.toLocaleString()} تومان</div>
                            
                            <!-- بخش امتیاز و نظرات -->
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <div class="review-rating">
                                    ${renderStars(rating)}
                                </div>
                                <span style="color: var(--light-text); font-size: 14px;">
                                    (${reviewCount} نظر)
                                </span>
                            </div>
                            
                            <div class="product-actions">
                                <button class="btn btn-primary" onclick="addToCart(${product.id})">
                                    <i class="fas fa-cart-plus"></i> افزودن به سبد
                                </button>
                                <button class="btn btn-warning" onclick="showReviewModal(${product.id})">
                                    <i class="fas fa-star"></i> امتیاز دهید
                                </button>
                                ${currentUser && currentUser.role === 'admin' ? `
                                    <button class="btn btn-danger" onclick="removeProduct(${product.id})">
                                        <i class="fas fa-trash"></i> حذف محصول
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // سیستم سبد خرید
        function addToCart(productId) {
            if (!currentUser) {
                showNotification('لطفاً ابتدا وارد حساب کاربری خود شوید', true);
                showSection('auth');
                return;
            }

            const product = products.find(p => p.id === productId);
            if (product) {
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        ...product,
                        quantity: 1
                    });
                }
                
                safeSetItem('taybadi_cart', cart);
                renderCart();
                showNotification('محصول به سبد خرید اضافه شد!');
            }
        }

        // تابع اصلاح شده برای رندر کردن سبد خرید
        function renderCart() {
            const container = document.getElementById('cart-items');
            const emptyCart = document.getElementById('empty-cart');
            const cartSummary = document.getElementById('cart-summary');
            const cartTotal = document.getElementById('cart-total');

            if (cart.length === 0) {
                emptyCart.style.display = 'block';
                cartSummary.style.display = 'none';
                // پاک کردن تخفیف وقتی سبد خالی است
                appliedDiscount = null;
                document.getElementById('discount-code-input').value = '';
                document.getElementById('discount-message').innerHTML = '';
                document.getElementById('remove-discount-btn').style.display = 'none';
                return;
            }

            emptyCart.style.display = 'none';
            cartSummary.style.display = 'block';

            let subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let total = subtotal;
            let discountAmount = 0;

            // محاسبه تخفیف
            if (appliedDiscount) {
                discountAmount = appliedDiscount.type === 'percentage' 
                    ? subtotal * (appliedDiscount.discount / 100)
                    : Math.min(appliedDiscount.discount, subtotal); // جلوگیری از تخفیف بیشتر از مبلغ کل
                
                total = subtotal - discountAmount;
                
                // نمایش اطلاعات تخفیف
                document.getElementById('discount-message').innerHTML = `
                    <div style="color: var(--success);">
                        <i class="fas fa-check-circle"></i> 
                        تخفیف ${appliedDiscount.discount}${appliedDiscount.type === 'percentage' ? '%' : ' تومان'} اعمال شد
                        <br>
                        <small>مبلغ تخفیف: ${discountAmount.toLocaleString()} تومان</small>
                    </div>
                `;
                
                // نمایش دکمه حذف تخفیف
                document.getElementById('remove-discount-btn').style.display = 'block';
            } else {
                document.getElementById('discount-message').innerHTML = '';
                document.getElementById('remove-discount-btn').style.display = 'none';
            }

            // نمایش آیتم‌های سبد خرید
            container.innerHTML = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                
                return `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                            <div class="cart-item-details">
                                <h3>${item.name}</h3>
                                <div class="cart-item-price">${item.price.toLocaleString()} تومان</div>
                            </div>
                        </div>
                        <div class="cart-item-actions">
                            <div class="cart-item-quantity">
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                            </div>
                            <div class="cart-item-total">${itemTotal.toLocaleString()} تومان</div>
                            <button class="btn btn-danger" onclick="removeFromCart(${item.id})">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // نمایش جمع‌بندی
            cartTotal.textContent = total.toLocaleString() + ' تومان';
            
            // نمایش جزئیات بیشتر اگر تخفیف اعمال شده
            if (appliedDiscount) {
                const summaryHTML = `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>جمع کل:</span>
                            <span>${subtotal.toLocaleString()} تومان</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px; color: var(--success);">
                            <span>تخفیف:</span>
                            <span>-${discountAmount.toLocaleString()} تومان</span>
                        </div>
                        <hr style="border-color: var(--dark-border); margin: 10px 0;">
                    </div>
                    <div class="cart-total">
                        <span class="total-label">مبلغ قابل پرداخت:</span>
                        <span class="total-amount">${total.toLocaleString()} تومان</span>
                    </div>
                `;
                document.querySelector('.cart-summary').innerHTML = summaryHTML + document.querySelector('.cart-summary').innerHTML;
            }
        }

        // تابع اصلاح شده برای به‌روزرسانی تعداد محصول
        function updateQuantity(productId, change) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            
            if (itemIndex !== -1) {
                cart[itemIndex].quantity += change;
                
                // اگر تعداد به صفر یا کمتر رسید، محصول از سبد حذف شود
                if (cart[itemIndex].quantity <= 0) {
                    cart.splice(itemIndex, 1);
                    showNotification('محصول از سبد خرید حذف شد');
                } else {
                    showNotification(`تعداد محصول به ${cart[itemIndex].quantity} عدد تغییر یافت`);
                }
                
                safeSetItem('taybadi_cart', cart);
                renderCart();
                updateOrderTotal();
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            safeSetItem('taybadi_cart', cart);
            renderCart();
            showNotification('محصول از سبد خرید حذف شد');
        }

        // تابع اصلاح شده برای به‌روزرسانی مبلغ سفارش
        function updateOrderTotal() {
            let subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let total = subtotal;
            
            if (appliedDiscount) {
                const discountAmount = appliedDiscount.type === 'percentage' 
                    ? subtotal * (appliedDiscount.discount / 100)
                    : Math.min(appliedDiscount.discount, subtotal);
                
                total = subtotal - discountAmount;
            }
            
            document.getElementById('order-total').textContent = total.toLocaleString() + ' تومان';
        }

        // نمایش صفحه پرداخت
        function showPaymentSection() {
            // بررسی ورود کاربر
            if (!currentUser) {
                showNotification('لطفاً ابتدا وارد حساب کاربری خود شوید', true);
                showSection('auth');
                return;
            }

            // اعتبارسنجی فرم اطلاعات مشتری
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const postalCode = document.getElementById('postal-code').value;

            if (!firstName || !lastName || !phone || !address || !city || !postalCode) {
                showNotification('لطفا تمام فیلدهای ضروری را پر کنید', true);
                return;
            }

            if (!validatePhone(phone)) {
                showNotification('لطفا شماره تماس معتبر وارد کنید (مثال: 09123456789)', true);
                return;
            }

            // ذخیره اطلاعات مشتری
            customerInfo = {
                firstName,
                lastName,
                phone,
                email: document.getElementById('email').value,
                address,
                city,
                postalCode,
                notes: document.getElementById('order-notes').value
            };
            safeSetItem('taybadi_customer_info', customerInfo);

            showSection('payment');
        }

        // بارگذاری اطلاعات مشتری
        function loadCustomerInfo() {
            if (customerInfo.firstName) {
                document.getElementById('first-name').value = customerInfo.firstName;
                document.getElementById('last-name').value = customerInfo.lastName;
                document.getElementById('phone').value = customerInfo.phone;
                document.getElementById('email').value = customerInfo.email || '';
                document.getElementById('address').value = customerInfo.address;
                document.getElementById('city').value = customerInfo.city;
                document.getElementById('postal-code').value = customerInfo.postalCode;
                document.getElementById('order-notes').value = customerInfo.notes || '';
            }
        }

        // سیستم پرداخت کارت به کارت
        function startPaymentTimer() {
            clearInterval(paymentTimer);
            timeLeft = 60 * 60;
            updateTimerDisplay();
            
            paymentTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(paymentTimer);
                    showNotification('⏰ زمان پرداخت به پایان رسیده است. لطفا مجدداً تلاش کنید.', true);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // تابع اصلاح شده برای به‌روزرسانی مبلغ پرداخت
        function updatePaymentAmount() {
            let subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let total = subtotal;
            
            if (appliedDiscount) {
                const discountAmount = appliedDiscount.type === 'percentage' 
                    ? subtotal * (appliedDiscount.discount / 100)
                    : Math.min(appliedDiscount.discount, subtotal);
                
                total = subtotal - discountAmount;
            }
            
            document.getElementById('payment-amount').textContent = total.toLocaleString() + ' تومان';
            document.getElementById('guide-amount').textContent = total.toLocaleString() + ' تومان';
        }

        function formatCardNumber(input) {
            let value = input.value.replace(/\D/g, '');
            let formattedValue = '';
            
            for (let i = 0; i < value.length && i < 16; i++) {
                if (i > 0 && i % 4 === 0) {
                    formattedValue += ' ';
                }
                formattedValue += value[i];
            }
            
            input.value = formattedValue;
        }

        function fallbackCopyText(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification('✅ متن کپی شد: ' + text);
            } catch (err) {
                showNotification('❌ خطا در کپی کردن متن', true);
            }
            document.body.removeChild(textArea);
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            let text = element.textContent || element.innerText;
            text = text.replace(/\s/g, '');
            
            // استفاده از روش جدید با fallback
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('✅ متن کپی شد: ' + text);
                }).catch(() => {
                    fallbackCopyText(text);
                });
            } else {
                fallbackCopyText(text);
            }
        }

        function copyDiscountCode(code) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(code).then(() => {
                    showNotification('✅ کد تخفیف کپی شد: ' + code);
                }).catch(() => {
                    fallbackCopyText(code);
                });
            } else {
                fallbackCopyText(code);
            }
        }

        function previewReceipt(event) {
            const file = event.target.files[0];
            const previewContainer = document.getElementById('preview-container');
            
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('❌ حجم فایل باید کمتر از 5MB باشد', true);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewContainer.innerHTML = `
                        <img src="${e.target.result}" class="preview-image" alt="پیش‌نمایش رسید">
                        <p style="margin-top: 10px; color: var(--success);">✅ فایل با موفقیت انتخاب شد</p>
                    `;
                    updateStep(2);
                };
                reader.readAsDataURL(file);
            }
        }

        function previewProductImage(event) {
            const file = event.target.files[0];
            const previewContainer = document.getElementById('product-preview-container');
            
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('❌ حجم فایل باید کمتر از 5MB باشد', true);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewContainer.innerHTML = `
                        <img src="${e.target.result}" class="preview-image" alt="پیش‌نمایش محصول">
                        <p style="margin-top: 10px; color: var(--success);">✅ فایل با موفقیت انتخاب شد</p>
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        function updateStep(stepNumber) {
            document.querySelectorAll('.step').forEach((step, index) => {
                if (index + 1 <= stepNumber) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }

        function submitPayment() {
            // بررسی ورود کاربر
            if (!currentUser) {
                showNotification('لطفاً ابتدا وارد حساب کاربری خود شوید', true);
                showSection('auth');
                return;
            }

            const receiptFile = document.getElementById('receipt').files[0];
            const userCard = document.getElementById('user-card').value;
            const phone = document.getElementById('payment-phone').value;
            const notes = document.getElementById('payment-notes').value;
            let subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let total = subtotal;
            
            // اعمال تخفیف اگر وجود دارد
            if (appliedDiscount) {
                const discountAmount = appliedDiscount.type === 'percentage' 
                    ? subtotal * (appliedDiscount.discount / 100)
                    : Math.min(appliedDiscount.discount, subtotal);
                
                total = subtotal - discountAmount;
            }
            
            if (!receiptFile) {
                showNotification('❌ لطفا تصویر رسید پرداخت را آپلود کنید', true);
                return;
            }

            if (!phone) {
                showNotification('❌ لطفا شماره تماس خود را وارد کنید', true);
                return;
            }

            if (!validatePhone(phone)) {
                showNotification('❌ لطفا شماره تماس معتبر وارد کنید', true);
                return;
            }
            
            const trackingNumber = 'PAY-' + Date.now();
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const paymentData = {
                    id: Date.now(),
                    trackingNumber: trackingNumber,
                    amount: total,
                    userCard: userCard,
                    phone: phone,
                    notes: notes,
                    customerInfo: customerInfo,
                    receipt: e.target.result,
                    items: [...cart],
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    userId: currentUser.id
                };
                
                payments.push(paymentData);
                safeSetItem('taybadi_payments', payments);
                
                // حذف محصولات از سبد خرید پس از پرداخت موفق
                cart = [];
                safeSetItem('taybadi_cart', cart);
                
                // اضافه کردن امتیاز به کاربر
                if (currentUser) {
                    const pointsEarned = Math.floor(total / 10000); // 1 امتیاز به ازای هر 10,000 تومان
                    currentUser.points = (currentUser.points || 0) + pointsEarned;
                    users = users.map(u => u.id === currentUser.id ? currentUser : u);
                    safeSetItem('taybadi_users', users);
                    safeSetItem('taybadi_current_user', currentUser);
                    
                    // اضافه کردن اطلاع‌رسانی دریافت امتیاز
                    addNotification('امتیاز دریافت کردید!', `شما ${pointsEarned} امتیاز برای این خرید دریافت کردید.`);
                }
                
                // نمایش پیام موفقیت
                document.getElementById('tracking-number').textContent = trackingNumber;
                document.getElementById('success-message').style.display = 'block';
                updateStep(3);
                
                // پاک کردن فرم
                document.getElementById('receipt').value = '';
                document.getElementById('user-card').value = '';
                document.getElementById('payment-phone').value = '';
                document.getElementById('payment-notes').value = '';
                document.getElementById('preview-container').innerHTML = '';
                
                customerInfo = {};
                safeSetItem('taybadi_customer_info', {});
                
                appliedDiscount = null;
                
                clearInterval(paymentTimer);
                
                showNotification(`✅ پرداخت شما ثبت شد! شماره پیگیری: ${trackingNumber}\nسبد خرید شما خالی شد.`);
                
                // به‌روزرسانی سبد خرید
                renderCart();
                
                // به‌روزرسانی پروفایل
                updateProfile();
            };
            
            reader.readAsDataURL(receiptFile);
        }

        // سیستم مدیریت
        function renderPayments() {
            const container = document.getElementById('payments-container');
            
            if (payments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-credit-card"></i>
                        <h3>هیچ پرداختی ثبت نشده است</h3>
                        <p>هنوز هیچ پرداختی در سیستم ثبت نشده است</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = payments.map(payment => `
                <div class="payment-item">
                    <div class="payment-header">
                        <div class="payment-info">
                            <div class="payment-id">پرداخت #${payment.trackingNumber}</div>
                            <div class="payment-date">${new Date(payment.createdAt).toLocaleDateString('fa-IR')}</div>
                        </div>
                        <div class="payment-status status-${payment.status}">
                            ${payment.status === 'pending' ? 'در انتظار تایید' : 
                              payment.status === 'completed' ? 'تکمیل شده' : 'لغو شده'}
                        </div>
                    </div>
                    
                    <div class="payment-details">
                        <div class="customer-info">
                            <div class="info-title">
                                <i class="fas fa-user"></i> اطلاعات مشتری
                            </div>
                            <div class="customer-details">
                                <div class="customer-name">${payment.customerInfo.firstName} ${payment.customerInfo.lastName}</div>
                                <div class="customer-contact">
                                    <i class="fas fa-phone"></i> ${payment.customerInfo.phone}
                                </div>
                                <div class="customer-contact">
                                    <i class="fas fa-map-marker-alt"></i> ${payment.customerInfo.city} - ${payment.customerInfo.address}
                                </div>
                                ${payment.userCard ? `
                                    <div class="customer-contact">
                                        <i class="fas fa-credit-card"></i> ${payment.userCard}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="payment-info-details">
                            <div class="info-title">
                                <i class="fas fa-money-bill-wave"></i> اطلاعات پرداخت
                            </div>
                            <div class="payment-details-list">
                                <div class="payment-amount">${payment.amount.toLocaleString()} تومان</div>
                                <div class="customer-contact">
                                    تعداد آیتم‌ها: ${payment.items.length}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${payment.receipt ? `
                        <div class="payment-receipt">
                            <div class="info-title">
                                <i class="fas fa-receipt"></i> تصویر رسید
                            </div>
                            <img src="${payment.receipt}" class="receipt-image" 
                                 onclick="this.style.transform = this.style.transform === 'scale(2)' ? 'scale(1)' : 'scale(2)'">
                        </div>
                    ` : ''}
                    
                    <div class="payment-actions">
                        <button class="btn btn-success" onclick="updatePaymentStatus(${payment.id}, 'completed')">
                            <i class="fas fa-check"></i> تایید پرداخت
                        </button>
                        <button class="btn btn-warning" onclick="updatePaymentStatus(${payment.id}, 'pending')">
                            <i class="fas fa-clock"></i> انتظار
                        </button>
                        <button class="btn btn-danger" onclick="deletePayment(${payment.id})">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updatePaymentStatus(paymentId, newStatus) {
            const payment = payments.find(p => p.id === paymentId);
            if (payment) {
                payment.status = newStatus;
                safeSetItem('taybadi_payments', payments);
                renderPayments();
                updateAdminStats();
                showNotification(`وضعیت پرداخت #${payment.trackingNumber} به "${newStatus === 'completed' ? 'تکمیل شده' : 'در انتظار'}" تغییر یافت`);
                
                // اضافه کردن اطلاع‌رسانی به کاربر
                if (payment.userId && newStatus === 'completed') {
                    const user = users.find(u => u.id === payment.userId);
                    if (user) {
                        addNotification('سفارش شما تایید شد!', `سفارش شما با شماره پیگیری ${payment.trackingNumber} تایید و ارسال خواهد شد.`, user.id);
                    }
                }
            }
        }

        function deletePayment(paymentId) {
            if (confirm('آیا از حذف این پرداخت اطمینان دارید؟ این عمل قابل بازگشت نیست!')) {
                payments = payments.filter(p => p.id !== paymentId);
                safeSetItem('taybadi_payments', payments);
                renderPayments();
                updateAdminStats();
                showNotification('پرداخت با موفقیت حذف شد!');
            }
        }

        function updateAdminStats() {
            const totalPayments = payments.length;
            const pendingPayments = payments.filter(p => p.status === 'pending').length;
            const completedPayments = payments.filter(p => p.status === 'completed').length;
            const totalRevenue = payments.filter(p => p.status === 'completed')
                .reduce((sum, p) => sum + p.amount, 0);
            
            document.getElementById('total-payments').textContent = totalPayments;
            document.getElementById('pending-payments').textContent = pendingPayments;
            document.getElementById('completed-payments').textContent = completedPayments;
            document.getElementById('total-revenue').textContent = totalRevenue.toLocaleString();
        }

        // حذف محصول
        function removeProduct(productId) {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('فقط مدیران می‌توانند محصول حذف کنند!', true);
                return;
            }

            if (confirm('آیا از حذف این محصول اطمینان دارید؟')) {
                products = products.filter(product => product.id !== productId);
                safeSetItem('taybadi_products', products);
                renderProducts();

                cart = cart.filter(item => item.id !== productId);
                safeSetItem('taybadi_cart', cart);
                renderCart();

                showNotification('محصول با موفقیت حذف شد!');
            }
        }

        // سیستم امتیازدهی و نظرات
        function calculateProductRating(productId) {
            const productReviews = reviews.filter(review => review.productId === productId);
            if (productReviews.length === 0) return 0;
            
            const totalRating = productReviews.reduce((sum, review) => sum + review.rating, 0);
            return totalRating / productReviews.length;
        }

        function getProductReviewCount(productId) {
            return reviews.filter(review => review.productId === productId).length;
        }

        function renderStars(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }
            
            if (halfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }
            
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }
            
            return stars;
        }

        function showReviewModal(productId) {
            if (!currentUser) {
                showNotification('لطفاً ابتدا وارد حساب کاربری خود شوید', true);
                showSection('auth');
                return;
            }

            const product = products.find(p => p.id === productId);
            if (!product) return;

            const modalHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 10000;">
                    <div style="background: var(--dark-card); padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; border: 1px solid var(--dark-border);">
                        <h3 style="color: var(--primary-color); margin-bottom: 20px;">امتیازدهی به ${product.name}</h3>
                        
                        <div class="form-group">
                            <label>امتیاز شما</label>
                            <div id="star-rating" style="font-size: 24px; color: #ffc107; margin: 10px 0;">
                                <i class="far fa-star" data-rating="1"></i>
                                <i class="far fa-star" data-rating="2"></i>
                                <i class="far fa-star" data-rating="3"></i>
                                <i class="far fa-star" data-rating="4"></i>
                                <i class="far fa-star" data-rating="5"></i>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="review-comment">نظر شما (اختیاری)</label>
                            <textarea id="review-comment" rows="3" placeholder="نظر خود درباره این محصول را بنویسید..."></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="submitReview(${productId})">
                                <i class="fas fa-paper-plane"></i> ارسال نظر
                            </button>
                            <button class="btn btn-danger" onclick="closeModal()">
                                <i class="fas fa-times"></i> انصراف
                            </button>
                        </div>
                    </div>
                </div>
            `;

            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHTML;
            document.body.appendChild(modalContainer);

            // اضافه کردن رویداد برای ستاره‌ها
            const stars = modalContainer.querySelectorAll('#star-rating i');
            let selectedRating = 0;

            stars.forEach(star => {
                star.addEventListener('mouseover', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    highlightStars(rating);
                });

                star.addEventListener('click', function() {
                    selectedRating = parseInt(this.getAttribute('data-rating'));
                    highlightStars(selectedRating);
                });
            });

            modalContainer.querySelector('#star-rating').addEventListener('mouseleave', function() {
                highlightStars(selectedRating);
            });

            function highlightStars(rating) {
                stars.forEach(star => {
                    const starRating = parseInt(star.getAttribute('data-rating'));
                    if (starRating <= rating) {
                        star.className = 'fas fa-star';
                    } else {
                        star.className = 'far fa-star';
                    }
                });
            }

            window.closeModal = function() {
                document.body.removeChild(modalContainer);
            };

            window.submitReview = function(productId) {
                if (selectedRating === 0) {
                    showNotification('لطفاً امتیاز خود را انتخاب کنید', true);
                    return;
                }

                const comment = document.getElementById('review-comment').value;

                const review = {
                    id: Date.now(),
                    productId: productId,
                    userId: currentUser.id,
                    userName: currentUser.name,
                    rating: selectedRating,
                    comment: comment,
                    createdAt: new Date().toISOString()
                };

                reviews.push(review);
                safeSetItem('taybadi_reviews', reviews);

                // اضافه کردن امتیاز به کاربر
                currentUser.points = (currentUser.points || 0) + 5; // 5 امتیاز برای هر نظر
                users = users.map(u => u.id === currentUser.id ? currentUser : u);
                safeSetItem('taybadi_users', users);
                safeSetItem('taybadi_current_user', currentUser);

                showNotification('نظر شما با موفقیت ثبت شد! 5 امتیاز دریافت کردید.');
                closeModal();
                renderProducts();
                updateProfile();
            };
        }

        // تابع جدید برای امتیازدهی به سفارش
        function showReviewForOrder(paymentId) {
            const payment = payments.find(p => p.id === paymentId);
            if (payment && payment.items.length > 0) {
                showReviewModal(payment.items[0].id);
            } else {
                showNotification('امکان امتیازدهی برای این سفارش وجود ندارد', true);
            }
        }

        // سیستم تخفیف - تابع اصلاح شده
        function applyDiscount() {
            const codeInput = document.getElementById('discount-code-input').value.trim().toUpperCase();
            const discount = discountCodes.find(dc => 
                dc.code.toUpperCase() === codeInput && dc.active === true
            );

            if (discount) {
                appliedDiscount = discount;
                renderCart();
                updateOrderTotal();
                updatePaymentAmount();
                showNotification(`✅ کد تخفیف "${discount.code}" اعمال شد!`);
                
                // غیرفعال کردن فیلد کد تخفیف پس از اعمال
                document.getElementById('discount-code-input').disabled = true;
            } else {
                appliedDiscount = null;
                document.getElementById('discount-message').innerHTML = `
                    <span style="color: var(--danger);">
                        <i class="fas fa-times-circle"></i> کد تخفیف معتبر نیست یا منقضی شده است
                    </span>
                `;
                showNotification('❌ کد تخفیف معتبر نیست!', true);
                renderCart();
            }
        }

        // تابع جدید برای حذف تخفیف
        function removeDiscount() {
            appliedDiscount = null;
            document.getElementById('discount-code-input').value = '';
            document.getElementById('discount-code-input').disabled = false;
            document.getElementById('discount-message').innerHTML = '';
            document.getElementById('remove-discount-btn').style.display = 'none';
            renderCart();
            updateOrderTotal();
            updatePaymentAmount();
            showNotification('تخفیف حذف شد');
        }

        // سیستم پروفایل کاربر
        function updateProfile() {
            const profileContainer = document.getElementById('profile-content');
            
            if (!currentUser) {
                profileContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user"></i>
                        <h3>لطفاً وارد حساب کاربری خود شوید</h3>
                        <p>برای مشاهده پروفایل و تاریخچه خریدها، ابتدا وارد شوید</p>
                        <button class="btn btn-primary" onclick="showSection('auth')">
                            <i class="fas fa-sign-in-alt"></i> ورود به حساب
                        </button>
                    </div>
                `;
                return;
            }

            // به‌روزرسانی اطلاعات پروفایل
            document.getElementById('profile-avatar').textContent = currentUser.name.charAt(0);
            document.getElementById('profile-name').textContent = currentUser.name;
            document.getElementById('profile-email').textContent = currentUser.email;
            document.getElementById('profile-join-date').textContent = `عضو since ${new Date(currentUser.createdAt).toLocaleDateString('fa-IR')}`;

            // نمایش اطلاعات پروفایل
            const userPayments = payments.filter(p => p.userId === currentUser.id);
            
            profileContainer.innerHTML = `
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number">${userPayments.length}</div>
                        <div class="stat-label">تعداد سفارشات</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${currentUser.points || 0}</div>
                        <div class="stat-label">امتیازهای شما</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${userPayments.filter(p => p.status === 'completed').length}</div>
                        <div class="stat-label">سفارشات تکمیل شده</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${userPayments.reduce((sum, p) => sum + p.amount, 0).toLocaleString()}</div>
                        <div class="stat-label">مجموع خریدها (تومان)</div>
                    </div>
                </div>

                <div class="order-history">
                    <h3 class="section-title"><i class="fas fa-history"></i> تاریخچه سفارشات</h3>
                    
                    ${userPayments.length === 0 ? `
                        <div class="empty-state">
                            <i class="fas fa-shopping-bag"></i>
                            <h3>هنوز سفارشی ثبت نکرده‌اید</h3>
                            <p>برای مشاهده تاریخچه سفارشات، اولین خرید خود را انجام دهید</p>
                            <button class="btn btn-primary" onclick="showSection('products')">
                                <i class="fas fa-shopping-bag"></i> مشاهده محصولات
                            </button>
                        </div>
                    ` : `
                        <div class="payments-container">
                            ${userPayments.map(payment => `
                                <div class="order-item">
                                    <div class="order-header">
                                        <div class="order-id">سفارش #${payment.trackingNumber}</div>
                                        <div class="order-date">${new Date(payment.createdAt).toLocaleDateString('fa-IR')}</div>
                                        <div class="order-status status-${payment.status}">
                                            ${payment.status === 'pending' ? 'در انتظار تایید' : 
                                              payment.status === 'completed' ? 'تکمیل شده' : 'لغو شده'}
                                        </div>
                                    </div>
                                    <div class="payment-details">
                                        <div class="customer-info">
                                            <div class="info-title">
                                                <i class="fas fa-box"></i> محصولات
                                            </div>
                                            <div class="customer-details">
                                                ${payment.items.map(item => `
                                                    <div>${item.name} - ${item.quantity} عدد</div>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div class="payment-info-details">
                                            <div class="info-title">
                                                <i class="fas fa-money-bill-wave"></i> اطلاعات پرداخت
                                            </div>
                                            <div class="payment-details-list">
                                                <div class="payment-amount">${payment.amount.toLocaleString()} تومان</div>
                                                <div class="customer-contact">
                                                    تعداد آیتم‌ها: ${payment.items.length}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="payment-actions">
                                        <button class="btn btn-primary" onclick="trackOrder('${payment.trackingNumber}')">
                                            <i class="fas fa-truck"></i> پیگیری سفارش
                                        </button>
                                        ${payment.status === 'completed' ? `
                                            <button class="btn btn-warning" onclick="showReviewForOrder(${payment.id})">
                                                <i class="fas fa-star"></i> امتیاز دهید
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        // سیستم پیگیری سفارش
        function trackOrder(trackingNumber = null) {
            const input = trackingNumber || document.getElementById('tracking-input').value;
            
            if (!input) {
                showNotification('لطفاً شماره پیگیری را وارد کنید', true);
                return;
            }

            const payment = payments.find(p => p.trackingNumber === input);
            
            if (!payment) {
                document.getElementById('tracking-result').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>سفارشی با این شماره پیگیری یافت نشد</h3>
                        <p>لطفاً شماره پیگیری را بررسی کنید</p>
                    </div>
                `;
                return;
            }

            const statusText = payment.status === 'pending' ? 'در انتظار تایید' : 
                              payment.status === 'completed' ? 'تکمیل شده' : 'لغو شده';
            
            const statusClass = payment.status === 'pending' ? 'status-processing' : 
                               payment.status === 'completed' ? 'status-delivered' : 'status-cancelled';

            document.getElementById('tracking-result').innerHTML = `
                <div class="payment-item">
                    <div class="payment-header">
                        <div class="payment-info">
                            <div class="payment-id">سفارش #${payment.trackingNumber}</div>
                            <div class="payment-date">${new Date(payment.createdAt).toLocaleDateString('fa-IR')}</div>
                        </div>
                        <div class="payment-status ${statusClass}">
                            ${statusText}
                        </div>
                    </div>
                    
                    <div class="tracking-steps">
                        <div class="tracking-step ${payment.status !== 'cancelled' ? 'completed' : ''}">
                            <div class="step-number">1</div>
                            <div class="step-text">ثبت سفارش</div>
                        </div>
                        <div class="tracking-step ${payment.status !== 'cancelled' && payment.status !== 'pending' ? 'completed' : ''}">
                            <div class="step-number">2</div>
                            <div class="step-text">تایید پرداخت</div>
                        </div>
                        <div class="tracking-step ${payment.status === 'completed' ? 'completed' : ''}">
                            <div class="step-number">3</div>
                            <div class="step-text">ارسال شده</div>
                        </div>
                        <div class="tracking-step ${payment.status === 'completed' ? 'completed' : ''}">
                            <div class="step-number">4</div>
                            <div class="step-text">تحویل شده</div>
                        </div>
                    </div>
                    
                    <div class="payment-details">
                        <div class="customer-info">
                            <div class="info-title">
                                <i class="fas fa-user"></i> اطلاعات مشتری
                            </div>
                            <div class="customer-details">
                                <div class="customer-name">${payment.customerInfo.firstName} ${payment.customerInfo.lastName}</div>
                                <div class="customer-contact">
                                    <i class="fas fa-phone"></i> ${payment.customerInfo.phone}
                                </div>
                                <div class="customer-contact">
                                    <i class="fas fa-map-marker-alt"></i> ${payment.customerInfo.city} - ${payment.customerInfo.address}
                                </div>
                            </div>
                        </div>
                        
                        <div class="payment-info-details">
                            <div class="info-title">
                                <i class="fas fa-money-bill-wave"></i> اطلاعات پرداخت
                            </div>
                            <div class="payment-details-list">
                                <div class="payment-amount">${payment.amount.toLocaleString()} تومان</div>
                                <div class="customer-contact">
                                    تعداد آیتم‌ها: ${payment.items.length}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // سیستم اطلاع‌رسانی
        function addNotification(title, message, userId = null) {
            const notification = {
                id: Date.now(),
                title,
                message,
                userId,
                read: false,
                createdAt: new Date().toISOString()
            };

            notifications.push(notification);
            safeSetItem('taybadi_notifications', notifications);
            
            updateNotifications();
        }

        function updateNotifications() {
            if (!currentUser) return;

            const userNotifications = notifications.filter(n => 
                !n.userId || n.userId === currentUser.id
            ).slice(-10).reverse(); // 10 اطلاع‌رسانی آخر

            const unreadCount = userNotifications.filter(n => !n.read).length;
            notificationBadge.textContent = unreadCount;

            // به‌روزرسانی پنل اطلاع‌رسانی
            notificationsPanel.innerHTML = userNotifications.map(notification => `
                <div class="notification-item" onclick="markAsRead(${notification.id})">
                    <div class="notification-title" style="font-weight: bold; color: white;">${notification.title}</div>
                    <div class="notification-message" style="font-size: 14px; color: var(--light-text); margin: 5px 0;">${notification.message}</div>
                    <div class="notification-time" style="font-size: 12px; color: var(--light-text);">${new Date(notification.createdAt).toLocaleDateString('fa-IR')}</div>
                </div>
            `).join('');

            if (userNotifications.length === 0) {
                notificationsPanel.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-bell-slash"></i>
                        <p>هیچ اطلاع‌رسانی جدیدی وجود ندارد</p>
                    </div>
                `;
            }
        }

        function markAsRead(notificationId) {
            notifications = notifications.map(n => 
                n.id === notificationId ? { ...n, read: true } : n
            );
            safeSetItem('taybadi_notifications', notifications);
            updateNotifications();
        }

        // نمایش/مخفی کردن پنل اطلاع‌رسانی
        notificationBell.addEventListener('click', function(e) {
            e.preventDefault();
            if (notificationsPanel.style.display === 'block') {
                notificationsPanel.style.display = 'none';
            } else {
                notificationsPanel.style.display = 'block';
                // علامت‌گذاری همه به عنوان خوانده شده وقتی پنل باز می‌شود
                notifications = notifications.map(n => ({ ...n, read: true }));
                safeSetItem('taybadi_notifications', notifications);
                updateNotifications();
            }
        });

        // بستن پنل اطلاع‌رسانی وقتی جای دیگر کلیک می‌شود
        document.addEventListener('click', function(e) {
            if (!notificationBell.contains(e.target) && !notificationsPanel.contains(e.target)) {
                notificationsPanel.style.display = 'none';
            }
        });

        // مقداردهی اولیه
        document.addEventListener('DOMContentLoaded', function() {
            // ایجاد کاربر ادمین پیش‌فرض اگر وجود ندارد
            if (!users.find(u => u.email === 'admin@taybadi.com')) {
                users.push({
                    id: 1,
                    name: 'مدیر سیستم',
                    email: 'admin@taybadi.com',
                    password: 'admin123',
                    role: 'admin',
                    createdAt: new Date().toISOString(),
                    points: 0
                });
                safeSetItem('taybadi_users', users);
            }

            // ایجاد کاربر معمولی نمونه
            if (!users.find(u => u.email === 'user@example.com')) {
                users.push({
                    id: 2,
                    name: 'کاربر نمونه',
                    email: 'user@example.com',
                    password: 'user123',
                    role: 'user',
                    createdAt: new Date().toISOString(),
                    points: 100
                });
                safeSetItem('taybadi_users', users);
            }

            // ایجاد محصولات نمونه اگر وجود ندارند
            if (products.length === 0) {
                products = [
                    {
                        id: 1,
                        name: 'گوشی هوشمند سامسونگ گلکسی A32',
                        price: 8500000,
                        description: 'گوشی هوشمند سامسونگ با پردازنده قدرتمند، دوربین چهارگانه و باتری 5000 میلی‌آمپر',
                        category: 'موبایل و تبلت',
                        image: 'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: 'لپ تاپ ایسوس گیمینگ TUF',
                        price: 28500000,
                        description: 'لپ تاپ گیمینگ ایسوس با کارت گرافیک RTX 3050، پردازنده Core i7 و رم 16GB',
                        category: 'لپ تاپ و کامپیوتر',
                        image: 'https://images.unsplash.com/photo-1496181133206-80ce9b88a853?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        name: 'هدفون بلوتوث سونی WH-1000XM4',
                        price: 1250000,
                        description: 'هدفون بی‌سیم با کیفیت صدای عالی، حذف نویز فعال و باتری 30 ساعته',
                        category: 'کالای دیجیتال',
                        image: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 4,
                        name: 'قهوه ترک ارگانیک',
                        price: 85000,
                        description: 'قهوه ترک ارگانیک 250 گرمی با عطر و طعم فوق‌العاده',
                        category: 'خوراکی و نوشیدنی',
                        image: 'https://images.unsplash.com/photo-1587734195503-904fca47e0e9?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 5,
                        name: 'کتاب آموزش برنامه‌نویسی وب',
                        price: 120000,
                        description: 'کتاب جامع آموزش HTML, CSS, JavaScript برای مبتدیان',
                        category: 'کتاب و لوازم تحریر',
                        image: 'https://images.unsplash.com/photo-1512820790803-83ca734da794?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60',
                        createdAt: new Date().toISOString()
                    }
                ];
                safeSetItem('taybadi_products', products);
            }

            // ایجاد چند نظر نمونه
            if (reviews.length === 0) {
                reviews = [
                    {
                        id: 1,
                        productId: 1,
                        userId: 2,
                        userName: 'کاربر نمونه',
                        rating: 4,
                        comment: 'گوشی بسیار خوبی است، باتری فوق‌العاده‌ای دارد',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        productId: 2,
                        userId: 2,
                        userName: 'کاربر نمونه',
                        rating: 5,
                        comment: 'برای گیمینگ عالی است، گرافیک خیلی خوبی دارد',
                        createdAt: new Date().toISOString()
                    }
                ];
                safeSetItem('taybadi_reviews', reviews);
            }

            // ایجاد چند اطلاع‌رسانی نمونه
            if (notifications.length === 0) {
                notifications = [
                    {
                        id: 1,
                        title: 'خوش آمدید!',
                        message: 'به تایبادی بخر خوش آمدید. از خرید خود لذت ببرید.',
                        userId: null,
                        read: false,
                        createdAt: new Date().toISOString()
                    }
                ];
                safeSetItem('taybadi_notifications', notifications);
            }

            // رویدادهای ناوبری
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    showSection(sectionId);
                });
            });

            // رویداد دکمه پرداخت
            checkoutBtn.addEventListener('click', function() {
                if (!currentUser) {
                    showNotification('لطفاً ابتدا وارد حساب کاربری خود شوید', true);
                    showSection('auth');
                    return;
                }
                
                if (cart.length === 0) {
                    showNotification('سبد خرید شما خالی است!', true);
                    return;
                }
                showSection('customer-info');
            });

            // رویداد فرم محصول
            document.getElementById('product-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!currentUser || currentUser.role !== 'admin') {
                    showNotification('فقط مدیران می‌توانند محصول اضافه کنند!', true);
                    showSection('auth');
                    return;
                }

                const name = document.getElementById('product-name').value;
                const price = parseInt(document.getElementById('product-price').value);
                const description = document.getElementById('product-description').value;
                const category = document.getElementById('product-category').value;
                const imageFile = document.getElementById('product-image').files[0];
                
                if (!imageFile) {
                    showNotification('لطفاً یک عکس برای محصول انتخاب کنید', true);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const newProduct = {
                        id: Date.now(),
                        name,
                        price: Number(price),
                        description,
                        category,
                        image: e.target.result,
                        createdAt: new Date().toISOString()
                    };

                    products.push(newProduct);
                    safeSetItem('taybadi_products', products);
                    renderProducts();

                    document.getElementById('product-form').reset();
                    document.getElementById('product-preview-container').innerHTML = '';

                    showNotification('محصول جدید با موفقیت اضافه شد!');
                };
                reader.readAsDataURL(imageFile);
            });

            // رویدادهای تب‌های احراز هویت
            authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');

                    authTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    authForms.forEach(form => form.classList.remove('active'));
                    document.getElementById(`${tabId}-form`).classList.add('active');
                });
            });

            // رویداد فرم ورود
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });

            // رویداد فرم ثبت‌نام
            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                register();
            });

            // رویدادهای فیلتر و مرتب‌سازی
            categoryFilter.addEventListener('change', renderProducts);
            sortSelect.addEventListener('change', renderProducts);

            // به‌روزرسانی رابط کاربری
            updateAuthUI();
            renderProducts();
            updateNotifications();
        });
    </script>
</body>
</html>